# CSV æ™ºèƒ½æ‹†åˆ†å·¥å…· - å¯è§†åŒ–æ–‡æ¡£

## 1. æ ¸å¿ƒæµç¨‹å›¾

### 1.1 ä¸»æµç¨‹ï¼ˆsplit å‘½ä»¤ï¼‰

```mermaid
flowchart TD
    Start([å¼€å§‹: splitå‘½ä»¤]) --> ParseParams[è§£æå‘½ä»¤è¡Œå‚æ•°]
    ParseParams --> ParseFields[è§£æsplit_fieldså­—æ®µ]
    ParseFields --> GetFiles[è·å–CSVæ–‡ä»¶åˆ—è¡¨]
    GetFiles --> CheckFiles{æ˜¯å¦æ‰¾åˆ°æ–‡ä»¶?}
    CheckFiles -->|å¦| ErrorEnd[é”™è¯¯é€€å‡º]
    CheckFiles -->|æ˜¯| InitSplitter[åˆå§‹åŒ–CSVSplitter]
    InitSplitter --> PrepOutput[å‡†å¤‡è¾“å‡ºç›®å½•]
    PrepOutput --> LoopStart

    LoopStart{è¿˜æœ‰æ–‡ä»¶?} -->|æ˜¯| ReadCSV[è¯»å–CSVæ–‡ä»¶]
    ReadCSV --> ClassifyFields[å­—æ®µåˆ†ç±»: æ—¥æœŸ/æ™®é€š]
    ClassifyFields --> CheckValid{æœ‰æœ‰æ•ˆå­—æ®µ?}
    CheckValid -->|å¦| NextFile
    CheckValid -->|æ˜¯| SelectStrategy[é€‰æ‹©æ‹†åˆ†ç­–ç•¥]

    SelectStrategy --> Strategy{ç­–ç•¥ç±»å‹?}

    Strategy -->|å¤šæ™®é€šå­—æ®µâ‰¥2| CascadeSplit[çº§è”æ‹†åˆ†]
    Strategy -->|å¤šæ™®é€š+æ—¥æœŸ| CascadeDate[çº§è”+æ—¶é—´æ‹†åˆ†]
    Strategy -->|1æ™®é€š+1æ—¥æœŸ| ComboSplit[ç»„åˆæ‹†åˆ†]
    Strategy -->|1æ™®é€šå­—æ®µ| SingleField[å•å­—æ®µæ‹†åˆ†]
    Strategy -->|ä»…æ—¥æœŸ| DateOnly[æ—¶é—´æ‹†åˆ†]

    CascadeSplit --> SaveFiles
    CascadeDate --> SaveFiles
    ComboSplit --> SaveFiles
    SingleField --> SaveFiles
    DateOnly --> SaveFiles

    SaveFiles[ä¿å­˜è¾“å‡ºæ–‡ä»¶] --> UpdateStats[æ›´æ–°ç»Ÿè®¡ä¿¡æ¯]
    UpdateStats --> NextFile[å¤„ç†ä¸‹ä¸€ä¸ªæ–‡ä»¶]
    NextFile --> LoopStart

    LoopStart -->|å¦| PrintSummary[æ‰“å°å¤„ç†æ‘˜è¦]
    PrintSummary --> End([ç»“æŸ])
```

### 1.2 å­—æ®µåˆ†ç±»æµç¨‹

```mermaid
flowchart TD
    Start([å¼€å§‹: å­—æ®µåˆ†ç±»]) --> InputFields[è¾“å…¥: split_fieldsåˆ—è¡¨]
    InputFields --> LoopStart{è¿˜æœ‰å­—æ®µ?}

    LoopStart -->|æ˜¯| FieldExists{å­—æ®µå­˜åœ¨äº<br/>CSVä¸­?}
    FieldExists -->|å¦| WarnSkip[è­¦å‘Šå¹¶è·³è¿‡]
    WarnSkip --> LoopStart
    FieldExists -->|æ˜¯| CheckDate[æ£€æµ‹æ˜¯å¦ä¸ºæ—¥æœŸå­—æ®µ]

    CheckDate --> DateCalc[è®¡ç®—æ—¥æœŸæ ¼å¼åŒ¹é…æ¯”ä¾‹]
    DateCalc --> IsDate{åŒ¹é…æ¯”ä¾‹<br/>>= 80%?}

    IsDate -->|æ˜¯| AddDateField[æ·»åŠ åˆ°æ—¥æœŸå­—æ®µåˆ—è¡¨]
    IsDate -->|å¦| AddNormalField[æ·»åŠ åˆ°æ™®é€šå­—æ®µåˆ—è¡¨]

    AddDateField --> PrintDate[æ‰“å°: âœ“ è¯†åˆ«ä¸ºæ—¥æœŸå­—æ®µ]
    AddNormalField --> PrintNormal[æ‰“å°: âœ“ è¯†åˆ«ä¸ºæ™®é€šå­—æ®µ]

    PrintDate --> LoopStart
    PrintNormal --> LoopStart

    LoopStart -->|å¦| ReturnFields[è¿”å›: æ—¥æœŸå­—æ®µåˆ—è¡¨, æ™®é€šå­—æ®µåˆ—è¡¨]
    ReturnFields --> End([ç»“æŸ])
```

### 1.3 æ‹†åˆ†ç­–ç•¥å†³ç­–æµç¨‹

```mermaid
flowchart TD
    Start([å¼€å§‹: é€‰æ‹©æ‹†åˆ†ç­–ç•¥]) --> CheckFields{æ£€æŸ¥å­—æ®µç»„åˆ}

    CheckFields -->|æ— æœ‰æ•ˆå­—æ®µ| Error[æŠ¥é”™é€€å‡º]

    CheckFields -->|â‰¥2æ™®é€šå­—æ®µ + 1æ—¥æœŸ| CascadeDate[å¤šå­—æ®µçº§è”+æ—¶é—´æ‹†åˆ†]
    CheckFields -->|â‰¥2æ™®é€šå­—æ®µ| Cascade[å¤šå­—æ®µçº§è”æ‹†åˆ†]
    CheckFields -->|1æ™®é€šå­—æ®µ + 1æ—¥æœŸ| Combo[å­—æ®µ+æ—¶é—´ç»„åˆæ‹†åˆ†]
    CheckFields -->|1æ™®é€šå­—æ®µ| SingleNormal[å•æ™®é€šå­—æ®µæ‹†åˆ†]
    CheckFields -->|ä»…1æ—¥æœŸå­—æ®µ| SingleDate[å•æ—¶é—´å­—æ®µæ‹†åˆ†]

    CascadeDate --> Print1[æ‰“å°: çº§è”æ‹†åˆ†Nä¸ªå­—æ®µ + æ—¶é—´å‘¨æœŸ]
    Cascade --> Print2[æ‰“å°: çº§è”æ‹†åˆ†Nä¸ªå­—æ®µ]
    Combo --> Print3[æ‰“å°: æŒ‰å­—æ®µ + æ—¶é—´å‘¨æœŸ]
    SingleNormal --> Print4[æ‰“å°: æŒ‰å­—æ®µ]
    SingleDate --> Print5[æ‰“å°: æŒ‰æ—¶é—´å‘¨æœŸ]

    Print1 --> End1([æ‰§è¡Œç›¸åº”æ‹†åˆ†])
    Print2 --> End2([æ‰§è¡Œç›¸åº”æ‹†åˆ†])
    Print3 --> End3([æ‰§è¡Œç›¸åº”æ‹†åˆ†])
    Print4 --> End4([æ‰§è¡Œç›¸åº”æ‹†åˆ†])
    Print5 --> End5([æ‰§è¡Œç›¸åº”æ‹†åˆ†])
```

### 1.4 å¤šå­—æ®µçº§è”æ‹†åˆ†æµç¨‹ï¼ˆé€’å½’ï¼‰

```mermaid
flowchart TD
    Start([å¼€å§‹: çº§è”æ‹†åˆ†]) --> Init[level = 0<br/>suffix = '']

    Init --> CheckLevel{level >=<br/>å­—æ®µæ•°é‡?}
    CheckLevel -->|æ˜¯| SaveFile[è°ƒç”¨_split_by_sizeä¿å­˜]
    SaveFile --> Return([è¿”å›æ–‡ä»¶åˆ—è¡¨])

    CheckLevel -->|å¦| GetField[current_field = fields[level]]
    GetField --> GetUnique[è·å–å”¯ä¸€å€¼åˆ—è¡¨]
    GetUnique --> PrintInfo[æ‰“å°: ç¬¬Nå±‚æ‹†åˆ†, æ‰¾åˆ°Xä¸ªå€¼]

    PrintInfo --> ValueLoop{è¿˜æœ‰å”¯ä¸€å€¼?}
    ValueLoop -->|æ˜¯| FilterDF[è¿‡æ»¤: df[field] == value]
    FilterDF --> SafeName[ç”Ÿæˆå®‰å…¨æ–‡ä»¶å]
    SafeName --> BuildSuffix[new_suffix = suffix + '_' + safe_name]
    BuildSuffix --> Recursive[é€’å½’è°ƒç”¨: level + 1]
    Recursive --> ValueLoop

    ValueLoop -->|å¦| Return
```

### 1.5 äºŒæ¬¡æ‹†åˆ†æµç¨‹ï¼ˆæŒ‰è¡Œæ•°ï¼‰

```mermaid
flowchart TD
    Start([å¼€å§‹: äºŒæ¬¡æ‹†åˆ†]) --> GetTotal[total_rows = len(df)]

    GetTotal --> CheckThreshold{max_rows<br/>æ˜¯å¦è®¾ç½®?}
    CheckThreshold -->|å¦| SaveDirect[ç›´æ¥ä¿å­˜å®Œæ•´æ–‡ä»¶]
    CheckThreshold -->|æ˜¯| CheckSize{total_rows <=<br/>max_rows?}

    CheckSize -->|æ˜¯| SaveDirect
    CheckSize -->|å¦| CalcParts[è®¡ç®—æ‹†åˆ†ä»½æ•°<br/>num_parts = ceil(total/max_rows)]

    SaveDirect --> FormatName[æ–‡ä»¶å: base_name + suffix + .csv]
    FormatName --> WriteFile[å†™å…¥CSV]
    WriteFile --> Return1([è¿”å›æ–‡ä»¶åˆ—è¡¨])

    CalcParts --> PartLoop{part < num_parts?}

    PartLoop -->|æ˜¯| CalcRange[start = part * max_rows<br/>end = min((part+1)*max, total)]
    CalcRange --> SliceDF[part_df = df.iloc[start:end]]
    SliceDF --> FormatPartName[æ–‡ä»¶å: base_name + suffix + _part{part+1}.csv]
    FormatPartName --> WritePart[å†™å…¥CSV]
    WritePart --> Increment[part++]
    Increment --> PartLoop

    PartLoop -->|å¦| Return2([è¿”å›æ–‡ä»¶åˆ—è¡¨])
```

---

## 2. çŠ¶æ€å›¾

### 2.1 æ–‡ä»¶å¤„ç†çŠ¶æ€æœº

```mermaid
stateDiagram-v2
    [*] --> Idle: ç¨‹åºå¯åŠ¨

    Idle --> Parsing: æ¥æ”¶splitå‘½ä»¤
    Parsing --> Validating: å‚æ•°è§£æå®Œæˆ
    Validating --> Idle: å‚æ•°éªŒè¯å¤±è´¥
    Validating --> Reading: å‚æ•°éªŒè¯é€šè¿‡

    Reading --> Classifying: æ–‡ä»¶è¯»å–æˆåŠŸ
    Reading --> Error: æ–‡ä»¶è¯»å–å¤±è´¥

    Classifying --> Splitting: å­—æ®µåˆ†ç±»å®Œæˆ
    Classifying --> Error: æ— æœ‰æ•ˆå­—æ®µ

    Splitting --> Saving: æ•°æ®åˆ†ç»„å®Œæˆ
    Splitting --> Error: æ‹†åˆ†è¿‡ç¨‹å‡ºé”™

    Saving --> StatsUpdate: æ–‡ä»¶ä¿å­˜æˆåŠŸ
    Saving --> Error: æ–‡ä»¶ä¿å­˜å¤±è´¥

    StatsUpdate --> Reading: å¤„ç†ä¸‹ä¸€ä¸ªæ–‡ä»¶
    StatsUpdate --> Finished: æ‰€æœ‰æ–‡ä»¶å¤„ç†å®Œæˆ

    Error --> StatsUpdate: è®°å½•é”™è¯¯ç»§ç»­
    Error --> Finished: è‡´å‘½é”™è¯¯

    Finished --> [*]
```

### 2.2 æ—¥æœŸå­—æ®µæ£€æµ‹çŠ¶æ€

```mermaid
stateDiagram-v2
    [*] --> CheckValue: å¼€å§‹æ£€æµ‹

    CheckValue --> IsNull: å€¼æ˜¯å¦ä¸ºç©º?
    IsNull --> CheckValue: æ˜¯, è·³è¿‡
    IsNull --> MatchFormat: å¦, æ£€æµ‹æ ¼å¼

    MatchFormat --> FormatYYYYMMDD: å°è¯•yyyyMMddæ ¼å¼
    FormatYYYYMMDD --> Matched: åŒ¹é…æˆåŠŸ
    FormatYYYYMMDD --> FormatYYYYDash: åŒ¹é…å¤±è´¥

    FormatYYYYDash --> Matched: åŒ¹é…æˆåŠŸ
    FormatYYYYDash --> FormatYYYYSlash: åŒ¹é…å¤±è´¥

    FormatYYYYSlash --> Matched: åŒ¹é…æˆåŠŸ
    FormatYYYYSlash --> FormatDateTime: åŒ¹é…å¤±è´¥

    FormatDateTime --> Matched: åŒ¹é…æˆåŠŸ
    FormatDateTime --> NotMatched: åŒ¹é…å¤±è´¥

    Matched --> CountMatch: åŒ¹é…è®¡æ•°+1
    CountMatch --> CheckValue: ç»§ç»­ä¸‹ä¸€ä¸ªå€¼

    NotMatched --> CheckValue: ç»§ç»­ä¸‹ä¸€ä¸ªå€¼

    CheckValue --> CalculateRatio: æ‰€æœ‰å€¼æ£€æµ‹å®Œæˆ
    CalculateRatio --> IsDateField: ratio >= 0.8?

    IsDateField --> [*]: æ˜¯, æ—¥æœŸå­—æ®µ
    IsDateField --> [*]: å¦, æ™®é€šå­—æ®µ
```

---

## 3. æ•°æ®æµå›¾

### 3.1 ç³»ç»Ÿæ•°æ®æµ

```mermaid
flowchart LR
    Input[CSVè¾“å…¥æ–‡ä»¶] --> Read[è¯»å–æ¨¡å—]
    Read --> Detect[ç¼–ç æ£€æµ‹]
    Detect --> Parse[pandasè§£æ]

    Parse --> Classify[å­—æ®µåˆ†ç±»æ¨¡å—]
    Classify --> DateCheck[æ—¥æœŸæ£€æµ‹]
    Classify --> NormalCheck[æ™®é€šå­—æ®µ]

    DateCheck --> Strategy[ç­–ç•¥é€‰æ‹©]
    NormalCheck --> Strategy

    Strategy --> Group[æ•°æ®åˆ†ç»„]
    Group --> Filter1[æŒ‰å­—æ®µå€¼è¿‡æ»¤]
    Group --> Filter2[æŒ‰æ—¶é—´å‘¨æœŸè¿‡æ»¤]

    Filter1 --> Chunk[äºŒæ¬¡æ‹†åˆ†]
    Filter2 --> Chunk

    Chunk --> Output[è¾“å‡ºæ–‡ä»¶]
    Output --> Stats[ç»Ÿè®¡ä¿¡æ¯]

    Stats --> Display[ç»ˆç«¯æ˜¾ç¤º]
```

### 3.2 æ‹†åˆ†æ•°æ®æµè½¬ç¤ºä¾‹

```mermaid
flowchart LR
    Input[è®¢å•.csv<br/>100ä¸‡è¡Œ] --> Split1[æŒ‰çœä»½æ‹†åˆ†]

    Split1 --> GD[å¹¿ä¸œ.csv<br/>50ä¸‡è¡Œ]
    Split1 --> ZJ[æµ™æ±Ÿ.csv<br/>30ä¸‡è¡Œ]
    Split1 --> JS[æ±Ÿè‹.csv<br/>20ä¸‡è¡Œ]

    GD --> Check1{è¶…è¿‡é˜ˆå€¼?}
    ZJ --> Check2{è¶…è¿‡é˜ˆå€¼?}
    JS --> Check3{è¶…è¿‡é˜ˆå€¼?}

    Check1 -->|æ˜¯| Chunk1[äºŒæ¬¡æ‹†åˆ†]
    Check2 -->|å¦| Output2[æµ™æ±Ÿ.csv]
    Check3 -->|å¦| Output3[æ±Ÿè‹.csv]

    Chunk1 --> Part1[å¹¿ä¸œ_part1.csv<br/>25ä¸‡è¡Œ]
    Chunk1 --> Part2[å¹¿ä¸œ_part2.csv<br/>25ä¸‡è¡Œ]
```

---

## 4. æ—¶åºå›¾

### 4.1 splitå‘½ä»¤æ‰§è¡Œæ—¶åº

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant CLI as CLI
    participant Splitter as CSVSplitter
    participant DateUtil as DateUtils
    participant FileUtil as FileUtils
    participant File as æ–‡ä»¶ç³»ç»Ÿ

    User->>CLI: splitå‘½ä»¤
    CLI->>CLI: è§£æå‚æ•°
    CLI->>FileUtil: get_csv_files()
    FileUtil-->>CLI: æ–‡ä»¶åˆ—è¡¨

    loop æ¯ä¸ªæ–‡ä»¶
        CLI->>Splitter: split_single_file()
        Splitter->>File: è¯»å–CSV
        File-->>Splitter: DataFrame

        Splitter->>DateUtil: is_date_column()
        DateUtil-->>Splitter: å­—æ®µåˆ†ç±»ç»“æœ

        Splitter->>Splitter: æ‰§è¡Œæ‹†åˆ†ç­–ç•¥
        Splitter->>File: å†™å…¥æ‹†åˆ†æ–‡ä»¶
        File-->>Splitter: å†™å…¥å®Œæˆ

        Splitter->>Splitter: æ›´æ–°stats
    end

    CLI->>Splitter: print_summary()
    Splitter-->>User: å¤„ç†æ‘˜è¦
```

### 4.2 å¤šå­—æ®µçº§è”æ‹†åˆ†æ—¶åº

```mermaid
sequenceDiagram
    participant Caller as è°ƒç”¨è€…
    participant Splitter as CSVSplitter
    participant P as Pandas

    Caller->>Splitter: _split_multi_non_date_fields(df, ['çœä»½','åŸå¸‚'], level=0)

    Note over Splitter: Level 0: çœä»½
    Splitter->>P: df['çœä»½'].unique()
    P-->>Splitter: ['å¹¿ä¸œ','æµ™æ±Ÿ','æ±Ÿè‹']

    loop æ¯ä¸ªçœä»½å€¼
        Splitter->>P: df[df['çœä»½']=='å¹¿ä¸œ']
        P-->>Splitter: sub_df

        Note over Splitter: Level 1: åŸå¸‚ (é€’å½’)
        Splitter->>Splitter: _split_multi_non_date_fields(sub_df, ['çœä»½','åŸå¸‚'], level=1)

        Splitter->>P: sub_df['åŸå¸‚'].unique()
        P-->>Splitter: ['æ·±åœ³','å¹¿å·','ä½›å±±']

        loop æ¯ä¸ªåŸå¸‚å€¼
            Splitter->>P: sub_df[sub_df['åŸå¸‚']=='æ·±åœ³']
            P-->>Splitter: city_df
            Splitter->>Splitter: _split_by_size(city_df, 'orders', '_å¹¿ä¸œ_æ·±åœ³')
            Splitter-->>Caller: ('orders_å¹¿ä¸œ_æ·±åœ³.csv', è¡Œæ•°)
        end
    end
```

---

## 5. ç¤ºä¾‹å±•ç¤º

### 5.1 ç¤ºä¾‹æ•°æ®ä¸æ‹†åˆ†ç»“æœ

#### è¾“å…¥æ•°æ®ç¤ºä¾‹

| è®¢å•ID | çœä»½ | åŸå¸‚ | è®¢å•æ—¥æœŸ | é‡‘é¢ |
|--------|------|------|----------|------|
| 001 | å¹¿ä¸œ | æ·±åœ³ | 2024-01-10 | 100 |
| 002 | å¹¿ä¸œ | å¹¿å· | 2024-01-20 | 200 |
| 003 | å¹¿ä¸œ | æ·±åœ³ | 2024-02-05 | 150 |
| 004 | æµ™æ±Ÿ | æ­å· | 2024-01-15 | 300 |
| 005 | æµ™æ±Ÿ | å®æ³¢ | 2024-02-10 | 250 |
| 006 | æ±Ÿè‹ | å—äº¬ | 2024-01-25 | 180 |

#### æ‹†åˆ†ç­–ç•¥ä¸ç»“æœå¯¹æ¯”

| æ‹†åˆ†å‘½ä»¤ | è¾“å‡ºæ–‡ä»¶ | è¯´æ˜ |
|---------|---------|------|
| `--split-fields "çœä»½"` | `orders_å¹¿ä¸œ.csv`<br/>`orders_æµ™æ±Ÿ.csv`<br/>`orders_æ±Ÿè‹.csv` | æŒ‰çœä»½æ‹†åˆ† |
| `--split-fields "çœä»½,åŸå¸‚"` | `orders_å¹¿ä¸œ_æ·±åœ³.csv`<br/>`orders_å¹¿ä¸œ_å¹¿å·.csv`<br/>`orders_æµ™æ±Ÿ_æ­å·.csv`<br/>`orders_æµ™æ±Ÿ_å®æ³¢.csv`<br/>`orders_æ±Ÿè‹_å—äº¬.csv` | çº§è”æ‹†åˆ† |
| `--split-fields "çœä»½,è®¢å•æ—¥æœŸ" --time-period M` | `orders_å¹¿ä¸œ_2024-01.csv`<br/>`orders_å¹¿ä¸œ_2024-02.csv`<br/>`orders_æµ™æ±Ÿ_2024-01.csv`<br/>`orders_æµ™æ±Ÿ_2024-02.csv`<br/>`orders_æ±Ÿè‹_2024-01.csv` | å­—æ®µ+æœˆä»½ |
| `--split-fields "è®¢å•æ—¥æœŸ" --time-period Q` | `orders_2024-Q1.csv` | æŒ‰å­£åº¦ |

### 5.2 æ—¶é—´å‘¨æœŸæ‹†åˆ†ç¤ºä¾‹

#### æŒ‰ä¸åŒå‘¨æœŸæ‹†åˆ†çš„æ–‡ä»¶åå¯¹æ¯”

| åŸæ•°æ® | å¹´(Y) | åŠå¹´(H) | å­£åº¦(Q) | æœˆ(M) | åŠæœˆ(HM) | æ—¥(D) |
|--------|-------|---------|---------|-------|----------|-------|
| 2024-01-10 | `orders_2024.csv` | `orders_2024-H1.csv` | `orders_2024-Q1.csv` | `orders_2024-01.csv` | `orders_2024-01-HM1.csv` | `orders_2024-01-10.csv` |
| 2024-01-20 | `orders_2024.csv` | `orders_2024-H1.csv` | `orders_2024-Q1.csv` | `orders_2024-01.csv` | `orders_2024-01-HM2.csv` | `orders_2024-01-20.csv` |
| 2024-02-05 | `orders_2024.csv` | `orders_2024-H1.csv` | `orders_2024-Q1.csv` | `orders_2024-02.csv` | `orders_2024-02-HM1.csv` | `orders_2024-02-05.csv` |
| 2024-07-15 | `orders_2024.csv` | `orders_2024-H2.csv` | `orders_2024-Q3.csv` | `orders_2024-07.csv` | `orders_2024-07-HM1.csv` | `orders_2024-07-15.csv` |

### 5.3 äºŒæ¬¡æ‹†åˆ†ç¤ºä¾‹

#### åœºæ™¯ï¼šå¤§æ–‡ä»¶æ‹†åˆ†

```
è¾“å…¥: orders.csv (150ä¸‡è¡Œ)
æ‹†åˆ†å­—æ®µ: "çœä»½"
è¡Œæ•°é˜ˆå€¼: 50ä¸‡è¡Œ

ç¬¬1æ­¥: æŒ‰çœä»½æ‹†åˆ†
â”œâ”€â”€ å¹¿ä¸œ.csv (80ä¸‡è¡Œ) â†’ è¶…è¿‡é˜ˆå€¼!
â”œâ”€â”€ æµ™æ±Ÿ.csv (40ä¸‡è¡Œ)
â””â”€â”€ æ±Ÿè‹.csv (30ä¸‡è¡Œ)

ç¬¬2æ­¥: äºŒæ¬¡æ‹†åˆ†
â”œâ”€â”€ å¹¿ä¸œ_part1.csv (50ä¸‡è¡Œ)
â”œâ”€â”€ å¹¿ä¸œ_part2.csv (30ä¸‡è¡Œ)
â”œâ”€â”€ æµ™æ±Ÿ.csv (40ä¸‡è¡Œ)
â””â”€â”€ æ±Ÿè‹.csv (30ä¸‡è¡Œ)
```

### 5.4 è¾“å‡ºç›®å½•ç»“æ„ç¤ºä¾‹

```
split_data/
â”œâ”€â”€ è®¢å•æ•°æ®_å¹¿ä¸œ_æ·±åœ³_2024-01-HM1.csv
â”œâ”€â”€ è®¢å•æ•°æ®_å¹¿ä¸œ_æ·±åœ³_2024-01-HM2.csv
â”œâ”€â”€ è®¢å•æ•°æ®_å¹¿ä¸œ_å¹¿å·_2024-01-HM1.csv
â”œâ”€â”€ è®¢å•æ•°æ®_å¹¿ä¸œ_å¹¿å·_2024-01-HM2.csv
â”œâ”€â”€ è®¢å•æ•°æ®_æµ™æ±Ÿ_æ­å·_2024-01-HM1.csv
â”œâ”€â”€ è®¢å•æ•°æ®_æµ™æ±Ÿ_æ­å·_2024-01-HM2.csv
â””â”€â”€ è®¢å•æ•°æ®_æ±Ÿè‹_å—äº¬_2024-01-HM1.csv
```

---

## 6. è¾“å‡ºç•Œé¢å±•ç¤º

### 6.1 splitå‘½ä»¤è¾“å‡ºç¤ºä¾‹

```
ğŸš€ CSVæ™ºèƒ½æ‹†åˆ†å·¥å…· v1.4
============================================================
è¾“å…¥è·¯å¾„: ./data/orders.csv
æ‹†åˆ†å­—æ®µ: çœä»½,è®¢å•æ—¥æœŸ
æ—¶é—´å‘¨æœŸ: M
è¡Œæ•°æ‹†åˆ†: âœ… æ¯ 500,000 è¡Œ
è¾“å‡ºç›®å½•: ./split_data
============================================================

è§£æåçš„å­—æ®µ: ['çœä»½', 'è®¢å•æ—¥æœŸ']

æ‰¾åˆ° 1 ä¸ªCSVæ–‡ä»¶

============================================================
å¤„ç†æ–‡ä»¶: ./data/orders.csv
============================================================
  æ€»è¡Œæ•°: 1,500,000
  å­—æ®µæ•°: 10
  è¡Œæ•°æ‹†åˆ†: âœ… å•æ–‡ä»¶æœ€å¤§ 500,000 è¡Œ
  âœ“ 'çœä»½' è¯†åˆ«ä¸ºæ™®é€šå­—æ®µ
  âœ“ 'è®¢å•æ—¥æœŸ' è¯†åˆ«ä¸ºæ—¥æœŸå­—æ®µ

  æ‹†åˆ†ç­–ç•¥: æŒ‰ 'çœä»½' + 'è®¢å•æ—¥æœŸ' (æ—¶é—´å‘¨æœŸ: M)
     ç¬¬ä¸€å±‚æ‹†åˆ†: æ‰¾åˆ° 3 ä¸ª 'çœä»½' å€¼

     ç¬¬1å±‚ ('çœä»½'): 3 ä¸ªå€¼
       æ‹†åˆ†: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3

  âœ… å®Œæˆ! ç”Ÿæˆ 36 ä¸ªæ–‡ä»¶:
     - è®¢å•æ•°æ®_å¹¿ä¸œ_2024-01.csv (450,000 è¡Œ)
     - è®¢å•æ•°æ®_å¹¿ä¸œ_2024-02.csv (350,000 è¡Œ)
     - è®¢å•æ•°æ®_æµ™æ±Ÿ_2024-01.csv (300,000 è¡Œ)
     - è®¢å•æ•°æ®_æµ™æ±Ÿ_2024-02.csv (200,000 è¡Œ)
     - è®¢å•æ•°æ®_æ±Ÿè‹_2024-01.csv (150,000 è¡Œ)
     - è®¢å•æ•°æ®_æ±Ÿè‹_2024-02.csv (50,000 è¡Œ)

============================================================
å¤„ç†å®Œæˆ!
============================================================
è¾“å…¥æ–‡ä»¶: 1
æ€»è¡Œæ•°: 1,500,000
è¾“å‡ºæ–‡ä»¶: 36
è¾“å‡ºç›®å½•: /path/to/split_data
```

### 6.2 list-fieldså‘½ä»¤è¾“å‡ºç¤ºä¾‹

```
ğŸ“‹ æ–‡ä»¶å­—æ®µåˆ—è¡¨
============================================================
æ–‡ä»¶: ./data/orders.csv
ç¼–ç : utf-8

æ€»å­—æ®µæ•°: 10
============================================================
  1. ğŸ“… æ—¥æœŸ | è®¢å•æ—¥æœŸ              | æ ·ä¾‹: 20240115
  2. ğŸ“… æ—¥æœŸ | ç»“ç®—æ—¥æœŸ              | æ ·ä¾‹: 2024-01-15
  3. ğŸ“ æ™®é€š | çœä»½                  | æ ·ä¾‹: å¹¿ä¸œ
  4. ğŸ“ æ™®é€š | åŸå¸‚                  | æ ·ä¾‹: æ·±åœ³
  5. ğŸ“ æ™®é€š | ç½‘ç‚¹                  | æ ·ä¾‹: å—å±±è¥ä¸šç‚¹
  6. ğŸ“ æ™®é€š | å®¢æˆ·ç±»å‹              | æ ·ä¾‹: VIP
  7. ğŸ“ æ™®é€š | è®¢å•çŠ¶æ€              | æ ·ä¾‹: å·²å®Œæˆ
  8. ğŸ“ æ™®é€š | æ”¯ä»˜æ–¹å¼              | æ ·ä¾‹: å¾®ä¿¡æ”¯ä»˜
  9. ğŸ“ æ™®é€š | ç‰©æµå…¬å¸              | æ ·ä¾‹: é¡ºä¸°é€Ÿè¿
 10. ğŸ“ æ™®é€š | é‡‘é¢                  | æ ·ä¾‹: 299.5
```

---

## 7. æ—¶é—´å‘¨æœŸå¯è§†åŒ–

### 7.1 æ—¶é—´å‘¨æœŸå±‚çº§å…³ç³»

```mermaid
graph TD
    Year[å¹´ Y] --> Half1[ä¸ŠåŠå¹´ H1<br/>1-6æœˆ]
    Year --> Half2[ä¸‹åŠå¹´ H2<br/>7-12æœˆ]

    Half1 --> Q1[ä¸€å­£åº¦ Q1]
    Half1 --> Q2[äºŒå­£åº¦ Q2]
    Half2 --> Q3[ä¸‰å­£åº¦ Q3]
    Half2 --> Q4[å››å­£åº¦ Q4]

    Q1 --> M1[ä¸€æœˆ]
    Q1 --> M2[äºŒæœˆ]
    Q1 --> M3[ä¸‰æœˆ]

    Q2 --> M4[å››æœˆ]
    Q2 --> M5[äº”æœˆ]
    Q2 --> M6[å…­æœˆ]

    Q3 --> M7[ä¸ƒæœˆ]
    Q3 --> M8[å…«æœˆ]
    Q3 --> M9[ä¹æœˆ]

    Q4 --> M10[åæœˆ]
    Q4 --> M11[åä¸€æœˆ]
    Q4 --> M12[åäºŒæœˆ]

    M1 --> HM1[ä¸ŠåŠæœˆ HM1<br/>1-15æ—¥]
    M1 --> HM2[ä¸‹åŠæœˆ HM2<br/>16-31æ—¥]

    style Year fill:#e1f5ff
    style Half1 fill:#fff4e1
    style Half2 fill:#fff4e1
    style Q1 fill:#ffe1f5
    style Q2 fill:#ffe1f5
    style Q3 fill:#ffe1f5
    style Q4 fill:#ffe1f5
```

### 7.2 æ—¶é—´å‘¨æœŸæ ¼å¼å¯¹æ¯”

```mermaid
graph LR
    subgraph è¾“å…¥
    A[2024-01-15]
    B[2024-07-20]
    C[2024-12-05]
    end

    subgraph å¹´
    A1[2024]
    B1[2024]
    C1[2024]
    end

    subgraph åŠå¹´
    A2[2024-H1]
    B2[2024-H2]
    C2[2024-H2]
    end

    subgraph å­£åº¦
    A3[2024-Q1]
    B3[2024-Q3]
    C3[2024-Q4]
    end

    subgraph æœˆ
    A4[2024-01]
    B4[2024-07]
    C4[2024-12]
    end

    subgraph åŠæœˆ
    A5[2024-01-HM1]
    B5[2024-07-HM2]
    C5[2024-12-HM1]
    end

    A --> A1
    B --> B1
    C --> C1

    A1 --> A2
    B1 --> B2
    C1 --> C2

    A2 --> A3
    B2 --> B3
    C2 --> C3

    A3 --> A4
    B3 --> B4
    C3 --> C4

    A4 --> A5
    B4 --> B5
    C4 --> C5
```

---

## 8. é”™è¯¯å¤„ç†æµç¨‹

### 8.1 æ–‡ä»¶è¯»å–é”™è¯¯å¤„ç†

```mermaid
flowchart TD
    Start([å¼€å§‹è¯»å–æ–‡ä»¶]) --> DetectEnc[æ£€æµ‹ç¼–ç  chardet]
    DetectEnc --> TryRead[å°è¯•è¯»å–]
    TryRead --> Success{è¯»å–æˆåŠŸ?}

    Success -->|æ˜¯| ReturnDF[è¿”å›DataFrame]
    Success -->|å¦| TryUTF8[å°è¯• utf-8]

    TryUTF8 --> CheckUTF8{æˆåŠŸ?}
    CheckUTF8 -->|æ˜¯| ReturnDF
    CheckUTF8 -->|å¦| TryGBK[å°è¯• gbk]

    TryGBK --> CheckGBK{æˆåŠŸ?}
    CheckGBK -->|æ˜¯| ReturnDF
    CheckGBK -->|å¦| TryGB2312[å°è¯• gb2312]

    TryGB2312 --> CheckGB2312{æˆåŠŸ?}
    CheckGB2312 -->|æ˜¯| ReturnDF
    CheckGB2312 -->|å¦| TryLatin[å°è¯• latin1]

    TryLatin --> CheckLatin{æˆåŠŸ?}
    CheckLatin -->|æ˜¯| ReturnDF
    CheckLatin -->|å¦| RaiseError[æŠ›å‡ºå¼‚å¸¸]

    RaiseError --> LogError[è®°å½•é”™è¯¯ä¿¡æ¯]
    LogError --> SkipFile[è·³è¿‡è¯¥æ–‡ä»¶]
    SkipFile --> End([ç»“æŸ])
```

### 8.2 æ—¥æœŸå¤„ç†ç©ºå€¼æµç¨‹

```mermaid
flowchart TD
    Start([æ—¥æœŸå­—æ®µå¤„ç†]) --> ConvertDate[è½¬æ¢ä¸ºdatetime]
    ConvertDate --> SplitValid[åˆ†ç¦»æœ‰æ•ˆ/æ— æ•ˆå€¼]

    SplitValid --> ValidData[æœ‰æ•ˆæ—¥æœŸæ•°æ®]
    SplitValid --> NullData[æ— æ•ˆ/ç©ºæ—¥æœŸæ•°æ®]

    ValidData --> GroupPeriod[æŒ‰æ—¶é—´å‘¨æœŸåˆ†ç»„]
    GroupPeriod --> LoopPeriod{éå†å‘¨æœŸ}

    LoopPeriod -->|æœ‰| SavePeriod[ä¿å­˜å‘¨æœŸæ–‡ä»¶]
    SavePeriod --> LoopPeriod

    LoopPeriod -->|æ— | CheckNull{æœ‰ç©ºå€¼æ•°æ®?}

    NullData --> CheckNull
    CheckNull -->|æ˜¯| SaveNull[ä¿å­˜ *_NULL.csv]
    CheckNull -->|å¦| End([ç»“æŸ])
    SaveNull --> End
```

---

## 9. æ€§èƒ½åˆ†æå›¾

### 9.1 å¤„ç†æ—¶é—´ä¸æ•°æ®è§„æ¨¡å…³ç³»

```
å¤„ç†æ—¶é—´ (ç§’)
    â”‚
 60 â”‚                                    â•­â”€â”€â”€â”€
 50 â”‚                              â•­â”€â”€â”€â”€â•¯
 40 â”‚                        â•­â”€â”€â”€â”€â•¯
 30 â”‚                  â•­â”€â”€â”€â”€â•¯
 20 â”‚            â•­â”€â”€â”€â”€â•¯
 10 â”‚      â•­â”€â”€â”€â”€â•¯
  0 â”‚â”€â”€â”€â”€â•¯
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      10ä¸‡   30ä¸‡   50ä¸‡   80ä¸‡  100ä¸‡  150ä¸‡
                    æ•°æ®è¡Œæ•°
```

### 9.2 å†…å­˜ä½¿ç”¨ä¸å­—æ®µå±‚çº§å…³ç³»

```
å†…å­˜å ç”¨ (MB)
    â”‚
500 â”‚                                    â•­â”€â”€â”€â”€
400 â”‚                              â•­â”€â”€â”€â”€â•¯
300 â”‚                        â•­â”€â”€â”€â”€â•¯
200 â”‚                  â•­â”€â”€â”€â”€â•¯
100 â”‚            â•­â”€â”€â”€â”€â•¯
 50 â”‚      â•­â”€â”€â”€â”€â•¯
  0 â”‚â”€â”€â”€â”€â•¯
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       1å±‚    2å±‚    3å±‚    4å±‚    5å±‚    6å±‚
                    å­—æ®µå±‚çº§
```

---

## 10. å¿«é€Ÿå‚è€ƒ

### 10.1 å‘½ä»¤é€ŸæŸ¥è¡¨

| éœ€æ±‚ | å‘½ä»¤ |
|-----|------|
| æŸ¥çœ‹å­—æ®µ | `python csv_splitter.py list-fields --file data.csv` |
| å•å­—æ®µæ‹†åˆ† | `python csv_splitter.py split --input data.csv --split-fields "çœä»½"` |
| æŒ‰æœˆæ‹†åˆ† | `python csv_splitter.py split --input data.csv --split-fields "æ—¥æœŸ" --time-period M` |
| å­—æ®µ+æœˆä»½ | `python csv_splitter.py split --input data.csv --split-fields "çœä»½,æ—¥æœŸ" --time-period M` |
| å¤§æ–‡ä»¶æ‹†åˆ† | `python csv_splitter.py split --input data.csv --split-fields "çœä»½" --max-rows 100000` |
| æ‰¹é‡å¤„ç† | `python csv_splitter.py split --input ./data/ --split-fields "æ—¥æœŸ" --recursive` |

### 10.2 æ—¶é—´å‘¨æœŸé€ŸæŸ¥è¡¨

| ç¬¦å· | å«ä¹‰ | ç¤ºä¾‹è¾“å‡º |
|-----|------|---------|
| Y | å¹´ | `2024.csv` |
| H | åŠå¹´ | `2024-H1.csv`, `2024-H2.csv` |
| Q | å­£åº¦ | `2024-Q1.csv` ~ `2024-Q4.csv` |
| M | æœˆ | `2024-01.csv` ~ `2024-12.csv` |
| HM | åŠæœˆ | `2024-01-HM1.csv`, `2024-01-HM2.csv` |
| D | æ—¥ | `2024-01-15.csv` |

### 10.3 æ–‡ä»¶å‘½åè§„åˆ™é€ŸæŸ¥

| åœºæ™¯ | å‘½åæ ¼å¼ | ç¤ºä¾‹ |
|-----|---------|------|
| æ ‡å‡†è¾“å‡º | `{åŸå}_{å­—æ®µå€¼}.csv` | `orders_å¹¿ä¸œ.csv` |
| å¤šå­—æ®µ | `{åŸå}_{å­—æ®µ1}_{å­—æ®µ2}.csv` | `orders_å¹¿ä¸œ_æ·±åœ³.csv` |
| å«æ—¶é—´ | `{åŸå}_{å­—æ®µ}_{æ—¶é—´}.csv` | `orders_å¹¿ä¸œ_2024-01.csv` |
| å«å­£åº¦ | `{åŸå}_{å­—æ®µ}_{æ—¶é—´}.csv` | `orders_å¹¿ä¸œ_2024-Q1.csv` |
| å«åŠæœˆ | `{åŸå}_{å­—æ®µ}_{æ—¶é—´}.csv` | `orders_å¹¿ä¸œ_2024-01-HM1.csv` |
| äºŒæ¬¡æ‹†åˆ† | `{åŸå}_{å­—æ®µ}_part{N}.csv` | `orders_å¹¿ä¸œ_part1.csv` |
| ç©ºå€¼ | `{åŸå}_{å­—æ®µ}_NULL.csv` | `orders_çœä»½_NULL.csv` |
