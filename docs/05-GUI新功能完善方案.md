# CSV æ‹†åˆ†å·¥å…· GUI æ–°åŠŸèƒ½å®Œå–„æ–¹æ¡ˆ

> ç‰ˆæœ¬: v2.2
> æ›´æ–°æ—¥æœŸ: 2026-01-27

---

## ä¸€ã€åŠŸèƒ½æ¦‚è¿°

### 1.1 å·²å®ŒæˆåŠŸèƒ½ï¼ˆCLIï¼‰

**åªæŒ‰è¡Œæ•°æ‹†åˆ†åŠŸèƒ½**
```bash
# å•æ–‡ä»¶æŒ‰è¡Œæ•°æ‹†åˆ†
python csv_splitter.py split --input data.csv --max-rows 500000

# æ–‡ä»¶å¤¹æ‰¹é‡æŒ‰è¡Œæ•°æ‹†åˆ†
python csv_splitter.py split --input ./data/ --max-rows 500000
```

### 1.2 å¾…å®ç°åŠŸèƒ½ï¼ˆGUIï¼‰

1. **æ‹†åˆ†ç±»å‹é€‰æ‹©**ï¼šæŒ‰å­—æ®µæ‹†åˆ†ã€æŒ‰è¡Œæ•°æ‹†åˆ†
2. **æ™ºèƒ½ç•Œé¢æ˜¾ç¤º**ï¼šæ ¹æ®ç”¨æˆ·é€‰æ‹©åŠ¨æ€æ˜¾ç¤º/éšè—ç›¸å…³é…ç½®
3. **é…ç½®æ‘˜è¦ä¼˜åŒ–**ï¼šé¢„è§ˆé¡µé¢æ˜¾ç¤ºæ›´è¯¦ç»†çš„é…ç½®ä¿¡æ¯
4. **è‡ªåŠ¨ç¼–ç æ£€æµ‹**ï¼šç§»é™¤ç¼–ç é€‰æ‹©ï¼Œè‡ªåŠ¨æ¢æµ‹
5. **è®¾ç½®é¡µé¢åŠŸèƒ½**ï¼šä¸»é¢˜åˆ‡æ¢ã€æç¤ºä¿¡æ¯ã€è‡ªåŠ¨é¢„è§ˆ

---

## äºŒã€è¯¦ç»†åŠŸèƒ½è§„åˆ’

### 2.1 æ–‡ä»¶é€‰æ‹©é¡µé¢ï¼ˆFilePageï¼‰

#### ä¿®æ”¹å†…å®¹

**1. åˆ é™¤æ–‡ä»¶ç¼–ç é€‰é¡¹**
```python
# åˆ é™¤æ•´ä¸ª"ç¼–ç "é€‰é¡¹å¡ç‰‡
# åŸå› ï¼šç¼–ç ä¼šè‡ªåŠ¨æ¢æµ‹ï¼Œæ— éœ€ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©
```

**2. æ–°å¢æ‹†åˆ†ç±»å‹é€‰æ‹©**
```python
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é€‰æ‹© CSV æ–‡ä»¶                      â”‚
â”‚  é€‰æ‹©è¦æ‹†åˆ†çš„ CSV æ–‡ä»¶...            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ‹†åˆ†ç±»å‹                           â”‚
â”‚  â—‰ æŒ‰å­—æ®µæ‹†åˆ†ï¼ˆé»˜è®¤ï¼‰               â”‚
â”‚     æ ¹æ®å­—æ®µå†…å®¹æ‹†åˆ†æ–‡ä»¶             â”‚
â”‚     æ”¯æŒæ—¶é—´å‘¨æœŸæ‹†åˆ†å’Œçº§è”æ‹†åˆ†       â”‚
â”‚                                     â”‚
â”‚  â—‹ æŒ‰è¡Œæ•°æ‹†åˆ†                       â”‚
â”‚     ç›´æ¥æŒ‰è¡Œæ•°æ‹†åˆ†ï¼Œä¸è€ƒè™‘å­—æ®µå†…å®¹   â”‚
â”‚     é€‚åˆå¤§æ–‡ä»¶å¿«é€Ÿæ‹†åˆ†               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### çŠ¶æ€ç®¡ç†
```python
# æ–°å¢çŠ¶æ€
'split_type': 'field',  # 'field' æˆ– 'rows'

# åˆ é™¤çŠ¶æ€
'encoding'  # æ”¹ä¸ºå†…éƒ¨è‡ªåŠ¨å¤„ç†ï¼Œä¸ä¿å­˜åˆ°çŠ¶æ€
```

#### å¯¼èˆªé€»è¾‘
```python
def get_next_page(self):
    split_type = self.app.get_state('split_type')
    if split_type == 'rows':
        # è·³è¿‡å­—æ®µé…ç½®ï¼Œç›´æ¥åˆ°æ‹†åˆ†è®¾ç½®
        return self.main_window.PAGE_SPLIT
    else:
        # æŒ‰å­—æ®µæ‹†åˆ†ï¼Œéœ€è¦é…ç½®å­—æ®µ
        return self.main_window.PAGE_FIELD
```

---

### 2.2 å­—æ®µé…ç½®é¡µé¢ï¼ˆFieldPageï¼‰

#### ä¿®æ”¹å†…å®¹

**æ ¹æ®æ‹†åˆ†ç±»å‹åŠ¨æ€æ˜¾ç¤ºï¼š**

**æƒ…å†µAï¼šæŒ‰å­—æ®µæ‹†åˆ†æ¨¡å¼ï¼ˆsplit_type='field'ï¼‰**
```python
# æ˜¾ç¤ºå½“å‰çš„å­—æ®µé€‰æ‹©ç•Œé¢
- å·¥å…·æ ï¼ˆå…¨é€‰/æ¸…ç©º/æ™ºèƒ½é€‰æ‹©ï¼‰
- å­—æ®µåˆ—è¡¨
- å·²é€‰æ‹©å­—æ®µæ˜¾ç¤º
```

**æƒ…å†µBï¼šæŒ‰è¡Œæ•°æ‹†åˆ†æ¨¡å¼ï¼ˆsplit_type='rows'ï¼‰**
```python
# æ˜¾ç¤ºè¯´æ˜ï¼Œéšè—å­—æ®µé€‰æ‹©
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é…ç½®æ‹†åˆ†å­—æ®µ                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â„¹ï¸  æŒ‰è¡Œæ•°æ‹†åˆ†æ— éœ€é€‰æ‹©å­—æ®µ         â”‚
â”‚                                     â”‚
â”‚  æŒ‰è¡Œæ•°æ‹†åˆ†æ¨¡å¼ä¼šç›´æ¥å°†æ–‡ä»¶æŒ‰æŒ‡å®š    â”‚
â”‚  è¡Œæ•°æ‹†åˆ†æˆå¤šä¸ªå°æ–‡ä»¶ï¼Œä¸éœ€è¦é€‰æ‹©    â”‚
â”‚  æ‹†åˆ†å­—æ®µã€‚                         â”‚
â”‚                                     â”‚
â”‚  è¯·ç‚¹å‡»"ä¸‹ä¸€æ­¥"ç»§ç»­é…ç½®æ‹†åˆ†å‚æ•°ã€‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å®ç°é€»è¾‘
```python
def on_activated(self):
    split_type = self.app.get_state('split_type')

    if split_type == 'rows':
        # æ˜¾ç¤ºè¯´æ˜ç•Œé¢
        self._show_rows_only_hint()
        # ç¦ç”¨"ä¸‹ä¸€æ­¥"æŒ‰é’®éªŒè¯
        self.enable_field_selection = False
    else:
        # æ˜¾ç¤ºå­—æ®µé€‰æ‹©ç•Œé¢ï¼ˆå½“å‰é€»è¾‘ï¼‰
        self._load_fields()
        self.enable_field_selection = True
```

---

### 2.3 æ‹†åˆ†è®¾ç½®é¡µé¢ï¼ˆSplitPageï¼‰

#### ä¿®æ”¹å†…å®¹

**æ ¹æ®æ˜¯å¦æœ‰æ—¥æœŸå­—æ®µå’Œæ‹†åˆ†ç±»å‹åŠ¨æ€æ˜¾ç¤ºï¼š**

**æƒ…å†µAï¼šæŒ‰å­—æ®µæ‹†åˆ† + æœ‰æ—¥æœŸå­—æ®µ**
```python
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ—¶é—´å‘¨æœŸè®¾ç½®                       â”‚
â”‚  â—‰ æŒ‰æ—¶é—´å‘¨æœŸæ‹†åˆ†                   â”‚
â”‚     æ—¶é—´å‘¨æœŸ: [å¹´ â–¼]                â”‚
â”‚     è¯´æ˜ï¼šæŒ‰å¹´ä»½æ‹†åˆ†                 â”‚
â”‚                                     â”‚
â”‚  â—‹ æŒ‰è¡Œæ•°æ‹†åˆ†å¤§æ–‡ä»¶                 â”‚
â”‚     å•æ–‡ä»¶æœ€å¤§è¡Œæ•°: [500000] è¡Œ     â”‚
â”‚     ğŸ’¡ åœ¨å­—æ®µæ‹†åˆ†åŸºç¡€ä¸ŠäºŒæ¬¡æ‹†åˆ†      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¾“å‡ºè®¾ç½®                           â”‚
â”‚  è¾“å‡ºç›®å½•: [./split_data    ] [æµè§ˆ]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æƒ…å†µBï¼šæŒ‰å­—æ®µæ‹†åˆ† + æ— æ—¥æœŸå­—æ®µ**
```python
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¡Œæ•°é™åˆ¶è®¾ç½®                       â”‚
â”‚  â—‹ ä¸è¿›è¡Œè¡Œæ•°æ‹†åˆ†ï¼ˆä¿æŒå®Œæ•´ï¼‰       â”‚
â”‚  â—‰ æŒ‰è¡Œæ•°æ‹†åˆ†å¤§æ–‡ä»¶                 â”‚
â”‚     å•æ–‡ä»¶æœ€å¤§è¡Œæ•°: [500000] è¡Œ     â”‚
â”‚                                     â”‚
â”‚  ğŸ’¡ è¯´æ˜ï¼šé€‰æ‹©çš„å­—æ®µä¸åŒ…å«æ—¥æœŸç±»å‹ï¼Œ â”‚
â”‚     æ–‡ä»¶å°†æŒ‰å­—æ®µå”¯ä¸€å€¼æ‹†åˆ†ã€‚å¯é€‰æ‹©    â”‚
â”‚     æ˜¯å¦å¯¹æ‹†åˆ†åçš„æ–‡ä»¶è¿›è¡Œè¡Œæ•°é™åˆ¶ã€‚  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¾“å‡ºè®¾ç½®                           â”‚
â”‚  è¾“å‡ºç›®å½•: [./split_data    ] [æµè§ˆ]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æƒ…å†µCï¼šæŒ‰è¡Œæ•°æ‹†åˆ†**
```python
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¡Œæ•°æ‹†åˆ†è®¾ç½®                       â”‚
â”‚  å•æ–‡ä»¶æœ€å¤§è¡Œæ•°: [500000] è¡Œ        â”‚
â”‚                                     â”‚
â”‚  ğŸ’¡ è¯´æ˜ï¼š                          â”‚
â”‚  - å¤§æ–‡ä»¶å°†è¢«æ‹†åˆ†æˆå¤šä¸ªå°æ–‡ä»¶        â”‚
â”‚  - æ¯ä¸ªæ–‡ä»¶æœ€å¤šåŒ…å«æŒ‡å®šè¡Œæ•°          â”‚
â”‚  - æ–‡ä»¶å‘½åï¼šåŸæ–‡ä»¶å_part1.csv      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¾“å‡ºè®¾ç½®                           â”‚
â”‚  è¾“å‡ºç›®å½•: [./split_data    ] [æµè§ˆ]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å®ç°é€»è¾‘
```python
def on_activated(self):
    split_type = self.app.get_state('split_type')
    has_date_fields = self._check_date_fields()

    if split_type == 'rows':
        # æŒ‰è¡Œæ•°æ‹†åˆ†æ¨¡å¼
        self._setup_rows_only_mode()
    elif has_date_fields:
        # æŒ‰å­—æ®µæ‹†åˆ† + æœ‰æ—¥æœŸå­—æ®µ
        self._setup_field_with_date_mode()
    else:
        # æŒ‰å­—æ®µæ‹†åˆ† + æ— æ—¥æœŸå­—æ®µ
        self._setup_field_without_date_mode()

def _check_date_fields(self):
    """æ£€æŸ¥é€‰æ‹©çš„å­—æ®µä¸­æ˜¯å¦åŒ…å«æ—¥æœŸå­—æ®µ"""
    date_fields = self.app.get_state('date_fields', [])
    return len(date_fields) > 0
```

---

### 2.4 é¢„è§ˆç¡®è®¤é¡µé¢ï¼ˆPreviewPageï¼‰

#### ä¿®æ”¹å†…å®¹

**æ–°å¢æ‹†åˆ†ç±»å‹å’Œè¯¦ç»†é…ç½®æ‘˜è¦ï¼š**

**æŒ‰å­—æ®µæ‹†åˆ†ç¤ºä¾‹ï¼š**
```python
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é…ç½®æ‘˜è¦                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¾“å…¥æ–‡ä»¶: sample.csv               â”‚
â”‚  æ–‡ä»¶å¤§å°: 120.5 MB                 â”‚
â”‚  æ€»è¡Œæ•°: 1,165,728                  â”‚
â”‚                                     â”‚
â”‚  æ‹†åˆ†ç±»å‹: æŒ‰å­—æ®µæ‹†åˆ†               â”‚  â† æ–°å¢
â”‚  æ‹†åˆ†å­—æ®µ: çœä»½, ç»“ç®—æ—¶é—´            â”‚  â† æ–°å¢
â”‚  æ—¶é—´å‘¨æœŸ: å¹´ (Y)                   â”‚  â† æ–°å¢
â”‚  è¡Œæ•°é™åˆ¶: ä¸æ‹†åˆ†                   â”‚  â† æ–°å¢
â”‚  è¾“å‡ºç›®å½•: ./split_data             â”‚
â”‚  æ–‡ä»¶ç¼–ç : UTF-8 (è‡ªåŠ¨æ£€æµ‹)         â”‚  â† ä¿®æ”¹
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ‹†åˆ†ç­–ç•¥:                          â”‚
â”‚  æŒ‰ã€Œçœä»½ã€å­—æ®µæ‹†åˆ†ï¼ŒæŒ‰ã€Œç»“ç®—æ—¶é—´ã€  â”‚  â† ä¿®æ”¹
â”‚  çš„å¹´å‘¨æœŸæ‹†åˆ†                       â”‚
â”‚                                     â”‚
â”‚  é¢„è®¡ç”Ÿæˆ: 48 ä¸ªæ–‡ä»¶                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŒ‰è¡Œæ•°æ‹†åˆ†ç¤ºä¾‹ï¼š**
```python
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é…ç½®æ‘˜è¦                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¾“å…¥æ–‡ä»¶: sample.csv               â”‚
â”‚  æ–‡ä»¶å¤§å°: 120.5 MB                 â”‚
â”‚  æ€»è¡Œæ•°: 1,165,728                  â”‚
â”‚                                     â”‚
â”‚  æ‹†åˆ†ç±»å‹: æŒ‰è¡Œæ•°æ‹†åˆ†               â”‚  â† æ–°å¢
â”‚  è¡Œæ•°é™åˆ¶: 500,000 è¡Œ               â”‚  â† æ–°å¢
â”‚  è¾“å‡ºç›®å½•: ./split_data             â”‚
â”‚  æ–‡ä»¶ç¼–ç : UTF-8 (è‡ªåŠ¨æ£€æµ‹)         â”‚  â† ä¿®æ”¹
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ‹†åˆ†ç­–ç•¥:                          â”‚
â”‚  æŒ‰è¡Œæ•°æ‹†åˆ†ï¼Œæ¯ 500,000 è¡Œä¸€ä¸ªæ–‡ä»¶   â”‚  â† ä¿®æ”¹
â”‚                                     â”‚
â”‚  é¢„è®¡ç”Ÿæˆ: 3 ä¸ªæ–‡ä»¶                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### é…ç½®æ‘˜è¦æ•°æ®ç»“æ„
```python
def get_config_summary(self):
    """è·å–é…ç½®æ‘˜è¦"""
    split_type = self.app.get_state('split_type')

    if split_type == 'field':
        return {
            'input_file': 'sample.csv',
            'file_size': '120.5 MB',
            'total_rows': '1,165,728',
            'split_type': 'æŒ‰å­—æ®µæ‹†åˆ†',
            'split_fields': ['çœä»½', 'ç»“ç®—æ—¶é—´'],
            'time_period': 'å¹´ (Y)',
            'max_rows': 'ä¸æ‹†åˆ†',
            'output_dir': './split_data',
            'encoding': 'UTF-8 (è‡ªåŠ¨æ£€æµ‹)',
            'strategy': 'æŒ‰ã€Œçœä»½ã€å­—æ®µæ‹†åˆ†ï¼ŒæŒ‰ã€Œç»“ç®—æ—¶é—´ã€çš„å¹´å‘¨æœŸæ‹†åˆ†',
            'estimated_files': 48,
        }
    else:  # rows
        return {
            'input_file': 'sample.csv',
            'file_size': '120.5 MB',
            'total_rows': '1,165,728',
            'split_type': 'æŒ‰è¡Œæ•°æ‹†åˆ†',
            'max_rows': '500,000 è¡Œ',
            'output_dir': './split_data',
            'encoding': 'UTF-8 (è‡ªåŠ¨æ£€æµ‹)',
            'strategy': 'æŒ‰è¡Œæ•°æ‹†åˆ†ï¼Œæ¯ 500,000 è¡Œä¸€ä¸ªæ–‡ä»¶',
            'estimated_files': 3,
        }
```

---

### 2.5 è®¾ç½®é¡µé¢ï¼ˆSettingsPageï¼‰

#### ä¿®æ”¹å†…å®¹

**å®ç°ä¸‰ä¸ªåŠŸèƒ½ï¼š**

**1. ä¸»é¢˜é€‰æ‹©**
```python
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç•Œé¢ä¸»é¢˜                           â”‚
â”‚  â—‰ ç³»ç»Ÿé»˜è®¤                         â”‚
â”‚  â—‹ æµ…è‰²ä¸»é¢˜                         â”‚
â”‚  â—‹ æ·±è‰²ä¸»é¢˜                         â”‚
â”‚                                     â”‚
â”‚  ğŸ’¡ ä¸»é¢˜å°†åœ¨ä¸‹æ¬¡å¯åŠ¨æ—¶ç”Ÿæ•ˆ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°é€»è¾‘ï¼š**
```python
class ThemeManager:
    """ä¸»é¢˜ç®¡ç†å™¨"""

    THEMES = {
        'system': 'ç³»ç»Ÿé»˜è®¤',
        'light': 'æµ…è‰²ä¸»é¢˜',
        'dark': 'æ·±è‰²ä¸»é¢˜',
    }

    @staticmethod
    def load_theme():
        """ä» QSettings åŠ è½½ä¸»é¢˜"""
        settings = QSettings('JunStudio', 'CSVSplitter')
        return settings.value('theme', 'system')

    @staticmethod
    def save_theme(theme):
        """ä¿å­˜ä¸»é¢˜åˆ° QSettings"""
        settings = QSettings('JunStudio', 'CSVSplitter')
        settings.setValue('theme', theme)

    @staticmethod
    def apply_theme(app, theme):
        """åº”ç”¨ä¸»é¢˜"""
        if theme == 'dark':
            # åŠ è½½æ·±è‰²ä¸»é¢˜æ ·å¼è¡¨
            style = ThemeManager._load_stylesheet('dark.qss')
        else:
            # åŠ è½½æµ…è‰²ä¸»é¢˜æ ·å¼è¡¨
            style = ThemeManager._load_stylesheet('light.qss')
        app.setStyleSheet(style)
```

**2. æ˜¾ç¤ºæç¤ºä¿¡æ¯**
```python
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æç¤ºä¿¡æ¯                           â”‚
â”‚  â—‰ æ˜¾ç¤ºæ“ä½œæç¤º                     â”‚
â”‚  â—‹ éšè—æ“ä½œæç¤º                     â”‚
â”‚                                     â”‚
â”‚  ğŸ’¡ æ§åˆ¶æ˜¯å¦æ˜¾ç¤ºå„é¡µé¢çš„æç¤ºå’Œè¯´æ˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°é€»è¾‘ï¼š**
```python
class HintManager:
    """æç¤ºä¿¡æ¯ç®¡ç†å™¨"""

    @staticmethod
    def load_hint_setting():
        """åŠ è½½æç¤ºè®¾ç½®"""
        settings = QSettings('JunStudio', 'CSVSplitter')
        return settings.value('show_hints', True, type=bool)

    @staticmethod
    def save_hint_setting(show):
        """ä¿å­˜æç¤ºè®¾ç½®"""
        settings = QSettings('JunStudio', 'CSVSplitter')
        settings.setValue('show_hints', show)

    @staticmethod
    def should_show_hints():
        """åˆ¤æ–­æ˜¯å¦åº”è¯¥æ˜¾ç¤ºæç¤º"""
        return HintManager.load_hint_setting()

# åœ¨å„é¡µé¢ä½¿ç”¨
def _create_section(self, title, description=''):
    """åˆ›å»ºåŒºåŸŸæ ‡é¢˜"""
    if not HintManager.should_show_hints():
        # éšè—è¯´æ˜
        description = ''

    # ... åˆ›å»ºç»„ä»¶
```

**3. è‡ªåŠ¨é¢„è§ˆ**
```python
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è‡ªåŠ¨é¢„è§ˆ                           â”‚
â”‚  â—‰ å¯ç”¨è‡ªåŠ¨é¢„è§ˆ                     â”‚
â”‚  â—‹ ç¦ç”¨è‡ªåŠ¨é¢„è§ˆ                     â”‚
â”‚                                     â”‚
â”‚  ğŸ’¡ å¯ç”¨åå°†è‡ªåŠ¨è·³è½¬åˆ°é¢„è§ˆç¡®è®¤é¡µé¢    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°é€»è¾‘ï¼š**
```python
class PreviewManager:
    """é¢„è§ˆç®¡ç†å™¨"""

    @staticmethod
    def load_auto_preview_setting():
        """åŠ è½½è‡ªåŠ¨é¢„è§ˆè®¾ç½®"""
        settings = QSettings('JunStudio', 'CSVSplitter')
        return settings.value('auto_preview', False, type=bool)

    @staticmethod
    def save_auto_preview_setting(enabled):
        """ä¿å­˜è‡ªåŠ¨é¢„è§ˆè®¾ç½®"""
        settings = QSettings('JunStudio', 'CSVSplitter')
        settings.setValue('auto_preview', enabled)

    @staticmethod
    def should_auto_preview():
        """åˆ¤æ–­æ˜¯å¦åº”è¯¥è‡ªåŠ¨é¢„è§ˆ"""
        return PreviewManager.load_auto_preview_setting()

# åœ¨ SplitPage ä½¿ç”¨
def _on_next_clicked(self):
    """ä¸‹ä¸€æ­¥æŒ‰é’®ç‚¹å‡»"""
    self.collect_data()

    if PreviewManager.should_auto_preview():
        # è·³è½¬åˆ°é¢„è§ˆé¡µé¢
        self.app.navigate_to(self.main_window.PAGE_PREVIEW)
    else:
        # ç›´æ¥å¼€å§‹æ‹†åˆ†
        self.app.navigate_to(self.main_window.PAGE_PROGRESS)
```

---

## ä¸‰ã€çŠ¶æ€ç®¡ç†

### 3.1 æ–°å¢çŠ¶æ€

```python
# app.py
self.state = {
    # ç°æœ‰çŠ¶æ€
    'file_path': None,
    'fields': [],
    'date_fields': [],
    'non_date_fields': [],
    'time_period': None,
    'max_rows': 500000,
    'output_dir': './split_data',
    'preview_data': None,

    # æ–°å¢çŠ¶æ€
    'split_type': 'field',  # 'field' æˆ– 'rows'

    # åˆ é™¤çŠ¶æ€
    # 'encoding': 'auto',  # æ”¹ä¸ºå†…éƒ¨è‡ªåŠ¨å¤„ç†
}
```

### 3.2 å­—æ®µæ”¶é›†æ—¶çš„åˆ†ç±»

```python
# FieldPage.collect_data()
def collect_data(self):
    """æ”¶é›†é¡µé¢æ•°æ®"""
    selected_items = self.field_list.selectedItems()
    fields = [
        item.data(Qt.ItemDataRole.UserRole)
        for item in selected_items
    ]

    # åˆ†ç±»å­—æ®µ
    date_fields = [f for f in fields if f in self.date_fields]
    non_date_fields = [f for f in fields if f in self.non_date_fields]

    # ä¿å­˜çŠ¶æ€ï¼ˆåŒ…å«åˆ†ç±»ä¿¡æ¯ï¼‰
    self.app.set_state('fields', fields)
    self.app.set_state('date_fields', date_fields)
    self.app.set_state('non_date_fields', non_date_fields)

    return {
        'fields': fields,
        'date_fields': date_fields,
        'non_date_fields': non_date_fields,
    }
```

---

## å››ã€ç¼–ç è‡ªåŠ¨æ£€æµ‹

### 4.1 æ–‡ä»¶è¯»å–æ”¹è¿›

```python
# FileUtils æ”¹è¿›
def read_csv_with_encoding(file_path, encoding='auto', **kwargs):
    """
    æ™ºèƒ½è¯»å– CSV æ–‡ä»¶

    Args:
        file_path: æ–‡ä»¶è·¯å¾„
        encoding: 'auto' è¡¨ç¤ºè‡ªåŠ¨æ£€æµ‹
        **kwargs: pandas.read_csv å…¶ä»–å‚æ•°

    Returns:
        DataFrame
    """
    if encoding == 'auto':
        # å°è¯•æ‰€æœ‰ç¼–ç 
        encodings = SUPPORTED_ENCODINGS  # ['utf-8', 'gbk', 'gb2312', 'latin1']
        last_error = None

        for enc in encodings:
            try:
                df = pd.read_csv(file_path, encoding=enc, **kwargs)
                return df
            except UnicodeDecodeError as e:
                last_error = e
                continue
            except Exception as e:
                # å…¶ä»–é”™è¯¯å¯èƒ½æ˜¯æ•°æ®æ ¼å¼é—®é¢˜ï¼Œç»§ç»­å°è¯•
                last_error = e
                continue

        # æ‰€æœ‰ç¼–ç éƒ½å¤±è´¥
        raise IOError(
            f"æ— æ³•è¯»å–æ–‡ä»¶ {file_path}ã€‚"
            f"å°è¯•äº†æ‰€æœ‰ç¼–ç ï¼ˆ{', '.join(encodings)}ï¼‰å‡å¤±è´¥ã€‚\n"
            f"æœ€åé”™è¯¯: {str(last_error)}"
        )
    else:
        # ä½¿ç”¨æŒ‡å®šç¼–ç 
        return pd.read_csv(file_path, encoding=encoding, **kwargs)
```

### 4.2 é”™è¯¯æç¤º

```python
# è¯»å–å¤±è´¥æ—¶å¼¹å‡ºå‹å¥½æç¤º
try:
    df = FileUtils.read_csv_with_encoding(file_path)
except IOError as e:
    QMessageBox.critical(
        self,
        'æ–‡ä»¶è¯»å–å¤±è´¥',
        f'æ— æ³•è¯»å–æ–‡ä»¶ï¼š{file_path}\n\n'
        f'åŸå› ï¼šç³»ç»Ÿå°è¯•äº†æ‰€æœ‰ç¼–ç æ ¼å¼éƒ½æ— æ³•æ­£ç¡®è¯»å–æ­¤æ–‡ä»¶ã€‚\n\n'
        f'å»ºè®®ï¼š\n'
        f'1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æŸå\n'
        f'2. ç¡®è®¤æ–‡ä»¶æ˜¯æœ‰æ•ˆçš„ CSV æ ¼å¼\n'
        f'3. å°è¯•ç”¨æ–‡æœ¬ç¼–è¾‘å™¨å¦å­˜ä¸º UTF-8 ç¼–ç '
    )
    return
```

---

## äº”ã€æ–‡ä»¶ä¿®æ”¹æ¸…å•

### 5.1 éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | ä¼˜å…ˆçº§ |
|------|---------|--------|
| `src/gui/core/app.py` | æ–°å¢ split_type çŠ¶æ€ | P0 |
| `src/gui/pages/file_page.py` | æ–°å¢æ‹†åˆ†ç±»å‹é€‰æ‹©ï¼Œåˆ é™¤ç¼–ç é€‰é¡¹ | P0 |
| `src/gui/pages/field_page.py` | æ–°å¢æŒ‰è¡Œæ•°æ‹†åˆ†è¯´æ˜ï¼Œæ”¶é›†æ—¥æœŸå­—æ®µåˆ†ç±» | P0 |
| `src/gui/pages/split_page.py` | æ”¹é€ ä¸ºä¸‰ç§æ¨¡å¼åŠ¨æ€æ˜¾ç¤º | P0 |
| `src/gui/pages/preview_page.py` | æ–°å¢è¯¦ç»†é…ç½®æ‘˜è¦ | P0 |
| `src/gui/pages/settings_page.py` | å®ç°ä¸»é¢˜ã€æç¤ºã€é¢„è§ˆåŠŸèƒ½ | P1 |
| `src/gui/core/theme_manager.py` | æ–°å¢ï¼šä¸»é¢˜ç®¡ç†å™¨ | P1 |
| `src/gui/workers/split_worker.py` | æ”¯æŒä¸¤ç§æ‹†åˆ†æ¨¡å¼ | P0 |
| `src/utils/file_utils.py` | æ”¹è¿›ç¼–ç è‡ªåŠ¨æ£€æµ‹å’Œé”™è¯¯æç¤º | P0 |

### 5.2 éœ€è¦æ–°å¢çš„æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `src/gui/core/theme_manager.py` | ä¸»é¢˜ç®¡ç†å™¨ | P1 |
| `src/gui/core/hint_manager.py` | æç¤ºä¿¡æ¯ç®¡ç†å™¨ | P1 |
| `src/gui/core/preview_manager.py` | é¢„è§ˆç®¡ç†å™¨ | P1 |
| `src/gui/styles/light_theme.qss` | æµ…è‰²ä¸»é¢˜æ ·å¼è¡¨ | P1 |
| `src/gui/styles/dark_theme.qss` | æ·±è‰²ä¸»é¢˜æ ·å¼è¡¨ | P1 |

### 5.3 ä¸éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

- `src/gui/pages/base_page.py` - åŸºç±»ä¸éœ€è¦ä¿®æ”¹
- `src/gui/pages/home_page.py` - é¦–é¡µä¸å—å½±å“
- `src/gui/pages/progress_page.py` - è¿›åº¦é¡µé¢é€šç”¨
- `src/gui/pages/result_page.py` - ç»“æœé¡µé¢é€šç”¨
- `src/splitter/csv_splitter.py` - å·²æ”¯æŒæŒ‰è¡Œæ•°æ‹†åˆ†

---

## å…­ã€å®ç°ä¼˜å…ˆçº§

### P0ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
1. âœ… CLI æŒ‰è¡Œæ•°æ‹†åˆ†åŠŸèƒ½ï¼ˆå·²å®Œæˆï¼‰
2. â¬œ GUI æ‹†åˆ†ç±»å‹é€‰æ‹©
3. â¬œ å­—æ®µé…ç½®é¡µé¢æŒ‰è¡Œæ•°æ‹†åˆ†è¯´æ˜
4. â¬œ æ‹†åˆ†è®¾ç½®é¡µé¢ä¸‰ç§æ¨¡å¼
5. â¬œ é¢„è§ˆé¡µé¢è¯¦ç»†é…ç½®æ‘˜è¦
6. â¬œ SplitWorker æ”¯æŒä¸¤ç§æ¨¡å¼
7. â¬œ ç¼–ç è‡ªåŠ¨æ£€æµ‹æ”¹è¿›

### P1ï¼ˆå¢å¼ºåŠŸèƒ½ï¼‰
1. â¬œ è®¾ç½®é¡µé¢ä¸»é¢˜åˆ‡æ¢
2. â¬œ è®¾ç½®é¡µé¢æç¤ºä¿¡æ¯æ§åˆ¶
3. â¬œ è®¾ç½®é¡µé¢è‡ªåŠ¨é¢„è§ˆæ§åˆ¶

---

## ä¸ƒã€æµ‹è¯•è®¡åˆ’

### 7.1 åŠŸèƒ½æµ‹è¯•

**æ‹†åˆ†ç±»å‹åˆ‡æ¢æµ‹è¯•**
- [ ] é€‰æ‹©"æŒ‰å­—æ®µæ‹†åˆ†"ï¼Œèƒ½æ­£ç¡®è·³è½¬åˆ°å­—æ®µé…ç½®é¡µé¢
- [ ] é€‰æ‹©"æŒ‰è¡Œæ•°æ‹†åˆ†"ï¼Œèƒ½è·³è¿‡å­—æ®µé…ç½®ç›´æ¥åˆ°æ‹†åˆ†è®¾ç½®
- [ ] åˆ‡æ¢æ‹†åˆ†ç±»å‹åï¼Œç›¸å…³é¡µé¢æ­£ç¡®æ˜¾ç¤º/éšè—

**åŠ¨æ€ç•Œé¢æ˜¾ç¤ºæµ‹è¯•**
- [ ] æŒ‰è¡Œæ•°æ‹†åˆ†æ—¶ï¼Œå­—æ®µé…ç½®é¡µé¢æ˜¾ç¤ºè¯´æ˜
- [ ] æŒ‰å­—æ®µæ‹†åˆ†+æœ‰æ—¥æœŸå­—æ®µï¼Œæ˜¾ç¤ºæ—¶é—´å‘¨æœŸè®¾ç½®
- [ ] æŒ‰å­—æ®µæ‹†åˆ†+æ— æ—¥æœŸå­—æ®µï¼Œéšè—æ—¶é—´å‘¨æœŸè®¾ç½®
- [ ] æŒ‰è¡Œæ•°æ‹†åˆ†ï¼Œåªæ˜¾ç¤ºè¡Œæ•°è®¾ç½®

**é…ç½®æ‘˜è¦æµ‹è¯•**
- [ ] æŒ‰å­—æ®µæ‹†åˆ†æ˜¾ç¤ºå®Œæ•´æ‘˜è¦
- [ ] æŒ‰è¡Œæ•°æ‹†åˆ†æ˜¾ç¤ºç®€åŒ–æ‘˜è¦
- [ ] æ‹†åˆ†ç­–ç•¥æè¿°å‡†ç¡®

### 7.2 é›†æˆæµ‹è¯•

**å®Œæ•´æµç¨‹æµ‹è¯•**
- [ ] æŒ‰å­—æ®µæ‹†åˆ†å®Œæ•´æµç¨‹
- [ ] æŒ‰è¡Œæ•°æ‹†åˆ†å®Œæ•´æµç¨‹
- [ ] æŒ‰å­—æ®µ+æ—¥æœŸæ‹†åˆ†æµç¨‹
- [ ] æŒ‰å­—æ®µ+è¡Œæ•°äºŒæ¬¡æ‹†åˆ†æµç¨‹

**ç¼–ç æ£€æµ‹æµ‹è¯•**
- [ ] UTF-8 æ–‡ä»¶è‡ªåŠ¨æ£€æµ‹
- [ ] GBK æ–‡ä»¶è‡ªåŠ¨æ£€æµ‹
- [ ] æŸåæ–‡ä»¶å‹å¥½æç¤º

### 7.3 UI æµ‹è¯•

- [ ] ä¸»é¢˜åˆ‡æ¢ç”Ÿæ•ˆ
- [ ] æç¤ºä¿¡æ¯æ˜¾ç¤º/éšè—
- [ ] è‡ªåŠ¨é¢„è§ˆåŠŸèƒ½

---

## å…«ã€é™„å½•

### 8.1 é…ç½®æ‘˜è¦å­—æ®µå¯¹ç…§è¡¨

| å­—æ®µ | æŒ‰å­—æ®µæ‹†åˆ† | æŒ‰è¡Œæ•°æ‹†åˆ† |
|------|-----------|-----------|
| è¾“å…¥æ–‡ä»¶ | âœ“ | âœ“ |
| æ–‡ä»¶å¤§å° | âœ“ | âœ“ |
| æ€»è¡Œæ•° | âœ“ | âœ“ |
| æ‹†åˆ†ç±»å‹ | "æŒ‰å­—æ®µæ‹†åˆ†" | "æŒ‰è¡Œæ•°æ‹†åˆ†" |
| æ‹†åˆ†å­—æ®µ | âœ“ | âœ— |
| æ—¶é—´å‘¨æœŸ | âœ“ | âœ— |
| è¡Œæ•°é™åˆ¶ | âœ“ï¼ˆå¯é€‰ï¼‰ | âœ“ï¼ˆå¿…å¡«ï¼‰ |
| è¾“å‡ºç›®å½• | âœ“ | âœ“ |
| æ–‡ä»¶ç¼–ç  | "XXX (è‡ªåŠ¨æ£€æµ‹)" | "XXX (è‡ªåŠ¨æ£€æµ‹)" |

### 8.2 æ‹†åˆ†ç­–ç•¥æè¿°æ¨¡æ¿

```python
# æŒ‰å­—æ®µæ‹†åˆ†
STRATEGY_TEMPLATES = {
    'field_only': 'æŒ‰ã€Œ{fields}ã€å­—æ®µæ‹†åˆ†',
    'field_with_date': 'æŒ‰ã€Œ{fields}ã€å­—æ®µæ‹†åˆ†ï¼ŒæŒ‰ã€Œ{date_field}ã€çš„{period}æ‹†åˆ†',
    'field_with_rows': 'æŒ‰ã€Œ{fields}ã€å­—æ®µæ‹†åˆ†ï¼Œæ¯{rows}è¡Œä¸€ä¸ªæ–‡ä»¶',
    'field_date_rows': 'æŒ‰ã€Œ{fields}ã€å­—æ®µæ‹†åˆ†ï¼ŒæŒ‰ã€Œ{date_field}ã€çš„{period}æ‹†åˆ†ï¼Œæ¯{rows}è¡Œä¸€ä¸ªæ–‡ä»¶',
}

# æŒ‰è¡Œæ•°æ‹†åˆ†
STRATEGY_TEMPLATES['rows_only'] = 'æŒ‰è¡Œæ•°æ‹†åˆ†ï¼Œæ¯{rows}è¡Œä¸€ä¸ªæ–‡ä»¶'
```

---

**æ–‡æ¡£ç‰ˆæœ¬:** v1.0
**æœ€åæ›´æ–°:** 2026-01-27
